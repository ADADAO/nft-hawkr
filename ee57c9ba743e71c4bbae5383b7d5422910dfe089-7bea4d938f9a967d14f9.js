"use strict";(self.webpackChunkyoctodao_interface=self.webpackChunkyoctodao_interface||[]).push([[524],{2226:function(a,e){var t={PROJECT_ID:"testnetL0riA5tMipy3cQ45FjldsEdTSTuClr8V"};e.Z=t},4832:function(a,e,t){t.d(e,{Z:function(){return S}});var r=t(5861),n=t(7757),c=t.n(n),s=t(2081),o=t(3427),d=t(2982),u="undefined"!=typeof window&&window.BigInt,i=null,f={setProtocolParameters:function(a,e,t,r){i={minUTxO:a,minFeeA:e,minFeeB:t,maxTxSize:r}},randomImprove:function(a,e,t,r){if(void 0===r&&(r=[]),!i)throw new Error("Protocol parameters not set. Use setProtocolParameters().");for(var n=u(e.len())*u(i.minUTxO),c=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0")),o=0;o<r.length;o++)c=_(r[o].output().amount(),c);for(var f={selection:(0,d.Z)(r),remaining:(0,d.Z)(a),subset:[],amount:c},l=function(a){for(var e=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0")),t=0;t<a.len();t++)e=_(a.get(t).amount(),e);return e}(e),h=function(a){var e=[];if(a.multiasset())for(var t=a.multiasset(),r=0;r<t.keys().len();r++)for(var n=t.keys().get(r),c=0;c<t.get(n).keys().len();c++){var o=s.Z.Cardano.Assets.new(),d=t.get(n).keys().get(c);o.insert(s.Z.Cardano.AssetName.from_bytes(d.to_bytes()),s.Z.Cardano.BigNum.from_bytes(t.get(n).get(d).to_bytes()));var u=s.Z.Cardano.MultiAsset.new();u.insert(s.Z.Cardano.ScriptHash.from_bytes(n.to_bytes()),o);var i=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0"));i.set_multiasset(u),e.push(i)}return(e=b(e,"DESC")).push(s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_bytes(a.coin().to_bytes()))),e}(l),g=0;g<h.length;g++)w(f,h[g]),f=m(f,h[g],t,n);h=b(h);for(var C=0;C<h.length;C++){w(f,h[C]);var Z={};Z.ideal=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0")).checked_add(h[C]).checked_add(h[C]),Z.maximum=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0")).checked_add(Z.ideal).checked_add(h[C]),p(f,h[C],t-f.selection.length,Z)}if(f.remaining.length>0){var x=f.amount.checked_sub(l),y=s.Z.Cardano.Value.new(s.Z.Cardano.min_ada_required(x,s.Z.Cardano.BigNum.from_str(i.minUTxO))),k=u(i.minFeeA)*u(i.maxTxSize)+u(i.minFeeB);if(k=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str(k.toString())),v(x,y=y.checked_add(k))<0){var T=y.checked_sub(s.Z.Cardano.Value.new(x.coin())).checked_add(s.Z.Cardano.Value.new(f.amount.coin()));w(f,T),f=m(f,T,t,n)}}return{input:f.selection,output:e,remaining:f.remaining,amount:f.amount,change:f.amount.checked_sub(l)}}};function m(a,e,t,r){try{a=l(function(a){return{selection:Z(a.selection),remaining:Z(a.remaining),subset:Z(a.subset),amount:x(a.amount)}}(a),e,t-a.selection.length,r)}catch(n){if("INPUT_LIMIT_EXCEEDED"!==n.message)throw n;a=function(a,e,t,r){a.subset=a.subset.sort((function(a,t){return Number(g(e,t.output().amount())-g(e,a.output().amount()))}));do{if(t<=0)throw new Error("INPUT_LIMIT_EXCEEDED");if(a.subset.length<=0){if(C(e,a.amount,0,0))throw new Error("MIN_UTXO_ERROR");throw new Error("INPUTS_EXHAUSTED")}var n=a.subset.splice(0,1).pop();a.selection.push(n),a.amount=_(n.output().amount(),a.amount),t--}while(!C(e,a.amount,r,a.subset.length-1));return a.remaining=[].concat((0,d.Z)(a.remaining),(0,d.Z)(a.subset)),a.subset=[],a}(a,e,t-a.selection.length,r)}return a}function l(a,e,t,r){var n=a.subset.length;if(C(e,a.amount,r,n))return a.remaining=[].concat((0,d.Z)(a.remaining),(0,d.Z)(a.subset)),a.subset=[],a;if(t<=0)throw new Error("INPUT_LIMIT_EXCEEDED");if(n<=0){if(C(e,a.amount,0,0))throw new Error("MIN_UTXO_ERROR");throw new Error("INPUTS_EXHAUSTED")}var c=a.subset.splice(Math.floor(Math.random()*n),1).pop();return a.selection.push(c),a.amount=_(c.output().amount(),a.amount),l(a,e,t-1,r)}function p(a,e,t,r){var n=a.subset.length;if(v(a.amount,r.ideal)>=0||n<=0||t<=0)return a.remaining=[].concat((0,d.Z)(a.remaining),(0,d.Z)(a.subset)),void(a.subset=[]);var c=a.subset.splice(Math.floor(Math.random()*n),1).pop(),o=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0")).checked_add(c.output().amount()).checked_add(e);return y(h(r.ideal)-h(o))<y(h(r.ideal)-h(e))&&v(o,r.maximum)<=0?(a.selection.push(c),a.amount=_(c.output().amount(),a.amount),t--):a.remaining.push(c),p(a,e,t,r)}function _(a,e){return e.checked_add(a)}function b(a,e){return void 0===e&&(e="ASC"),a.sort((function(a,t){var r=u("DESC"===e?-1:1);return Number((h(a)-h(t))*r)}))}function h(a){var e=u(0),t=u(a.coin().to_str());if(t>0)e=t;else if(a.multiasset()&&a.multiasset().len()>0){var r=a.multiasset().keys().get(0),n=a.multiasset().get(r).keys().get(0);e=u(a.multiasset().get(r).get(n).to_str())}return e}function g(a,e){var t=u(0);if(u(a.coin().to_str())>0)t=u(e.coin().to_str());else if(a.multiasset()&&e.multiasset()&&a.multiasset().len()>0&&e.multiasset().len()>0){var r=a.multiasset().keys().get(0),n=a.multiasset().get(r).keys().get(0);t=u(e.multiasset().get(r).get(n).to_str())}return t}function w(a,e){if(u(e.coin().to_str())<u(1)){for(var t=[],r=[],n=0;n<a.remaining.length;n++)void 0!==v(a.remaining[n].output().amount(),e)?t.push(a.remaining[n]):r.push(a.remaining[n]);a.subset=t,a.remaining=r}else a.subset=a.remaining.splice(0,a.remaining.length)}function C(a,e,t,r){var n=a;if(t&&u(a.coin().to_str())>0){var c=s.Z.Cardano.Value.new(s.Z.Cardano.min_ada_required(e,s.Z.Cardano.BigNum.from_str(t.toString())));if(v(e,c)<0)return!1;if(v(a,c)<0&&(n=c.checked_add(s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str(i.minUTxO)))),r>0){var o=u(i.minFeeA)*u(i.maxTxSize)+u(i.minFeeB);o=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str(o.toString())),n=n.checked_add(o)}}return v(e,n)>=0}var Z=function(a){return a.map((function(a){return s.Z.Cardano.TransactionUnspentOutput.from_bytes(a.to_bytes())}))},x=function(a){return s.Z.Cardano.Value.from_bytes(a.to_bytes())};function y(a){return a<0?a*u(-1):a}function v(a,e){var t=u(a.coin().to_str()),r=u(e.coin().to_str());if(e.multiasset()){var n=e.multiasset().keys().get(0),c=e.multiasset().get(n).keys().get(0);if(!a.multiasset()||!a.multiasset().len())return;if(!a.multiasset().get(n)||!a.multiasset().get(n).get(c))return;t=u(a.multiasset().get(n).get(c).to_str()),r=u(e.multiasset().get(n).get(c).to_str())}return t>=r?t===r?0:1:-1}var k=f,T=function(){var a=s.Z.Cardano.PlutusScripts.new();return a.add(s.Z.Cardano.PlutusScript.new((0,o.H_)("59100d010000332333222332233322233223322332232323332223233322232333333332222222232333222323333222232323322323332223232323322332232323333322222332233223322332233223322223223223232533530303330083333573466e1cd55cea8032400046094646464646666ae68cdc39aab9d5003480008ccc888ccc15000c008004dd71aba150033335502775ca04c6ae854008dd71aba135744a00446a0966a609866ae71241035054310004d49926135744a00226aae7940044dd50009aba135573ca00e46a08c6a608e66ae712410350543100048499263333573466e1d40112002205323333573466e1d401520002055235047353048335738921035054310004949926498cccd5cd19b8735573aa004900011980599191919191919191919191999ab9a3370e6aae754029200023333333333019335027232323333573466e1cd55cea8012400046603e606e6ae854008c0b0d5d09aba250022350563530573357389201035054310005849926135573ca00226ea8004d5d0a80519a8138141aba150093335502e75ca05a6ae854020ccd540b9d728169aba1500733502704035742a00c66a04e66aa0a2092eb4d5d0a8029919191999ab9a3370e6aae754009200023350213232323333573466e1cd55cea80124000466a05266a07eeb4d5d0a80118221aba135744a00446a0b46a60b666ae712401035054310005c49926135573ca00226ea8004d5d0a8011919191999ab9a3370e6aae7540092000233502733503f75a6ae854008c110d5d09aba2500223505a35305b3357389201035054310005c49926135573ca00226ea8004d5d09aba250022350563530573357389201035054310005849926135573ca00226ea8004d5d0a80219a813bae35742a00666a04e66aa0a2eb88004d5d0a801181b1aba135744a00446a0a46a60a666ae71241035054310005449926135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea8004d5d0a8011919191999ab9a3370ea00290031180f181c1aba135573ca00646666ae68cdc3a801240084603a60846ae84d55cf280211999ab9a3370ea00690011180e98169aba135573ca00a46666ae68cdc3a80224000460406eb8d5d09aab9e500623504d35304e3357389201035054310004f49926499264984d55cea80089baa001357426ae8940088d4118d4c11ccd5ce2490350543100048499261047135045353046335738920103505435000474984d55cf280089baa001135573a6ea80044dd50009109198008018011000911111111109199999999980080580500480400380300280200180110009109198008018011000891091980080180109000891091980080180109000891091980080180109000909111180200290911118018029091111801002909111180080290008919118011bac0013200135503b2233335573e0024a070466a06e60086ae84008c00cd5d100101811919191999ab9a3370e6aae75400d200023330073232323333573466e1cd55cea8012400046601a605c6ae854008cd40400a8d5d09aba25002235033353034335738921035054310003549926135573ca00226ea8004d5d0a801999aa805bae500a35742a00466a018eb8d5d09aba2500223502f353030335738921035054310003149926135744a00226aae7940044dd50009110919980080200180110009109198008018011000899aa800bae75a224464460046eac004c8004d540d488c8cccd55cf80112819919a81919aa81a98031aab9d5002300535573ca00460086ae8800c0ac4d5d080089119191999ab9a3370ea002900011a80418029aba135573ca00646666ae68cdc3a801240044a01046a0526a605466ae71241035054310002b499264984d55cea80089baa001121223002003112200112001232323333573466e1cd55cea8012400046600c600e6ae854008dd69aba135744a00446a0466a604866ae71241035054310002549926135573ca00226ea80048848cc00400c00880048c8cccd5cd19b8735573aa002900011bae357426aae7940088d407cd4c080cd5ce24810350543100021499261375400224464646666ae68cdc3a800a40084a00e46666ae68cdc3a8012400446a014600c6ae84d55cf280211999ab9a3370ea00690001280511a8111a981199ab9c490103505431000244992649926135573aa00226ea8004484888c00c0104488800844888004480048c8cccd5cd19b8750014800880188cccd5cd19b8750024800080188d4068d4c06ccd5ce249035054310001c499264984d55ce9baa0011220021220012001232323232323333573466e1d4005200c200b23333573466e1d4009200a200d23333573466e1d400d200823300b375c6ae854014dd69aba135744a00a46666ae68cdc3a8022400c46601a6eb8d5d0a8039bae357426ae89401c8cccd5cd19b875005480108cc048c050d5d0a8049bae357426ae8940248cccd5cd19b875006480088c050c054d5d09aab9e500b23333573466e1d401d2000230133016357426aae7940308d407cd4c080cd5ce2481035054310002149926499264992649926135573aa00826aae79400c4d55cf280109aab9e500113754002424444444600e01044244444446600c012010424444444600a010244444440082444444400644244444446600401201044244444446600201201040024646464646666ae68cdc3a800a400446660106eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d400920002300a300b357426aae7940188d4040d4c044cd5ce2490350543100012499264984d55cea80189aba25001135573ca00226ea80048488c00800c888488ccc00401401000c80048c8c8cccd5cd19b875001480088c018dd71aba135573ca00646666ae68cdc3a80124000460106eb8d5d09aab9e500423500a35300b3357389201035054310000c499264984d55cea80089baa001212230020032122300100320011122232323333573466e1cd55cea80124000466aa024600c6ae854008c014d5d09aba25002235007353008335738921035054310000949926135573ca00226ea8004498480048004848c004008800488848ccc00401000c00880044488008488488cc00401000c48004448848cc00400c0084480044880084880048004448c8c00400488cc00cc008008004cc8ccc888c8c8cc88cc88cc88ccc888ccc888cccccccc88888888cc88ccccc88888cccc8888cc88cc88cc88ccc888cc88ccc888cc88cc88cc88cc88ccc888cc88cc88cc88cc88c8c8c8c8c8c8cccc8888c8cc88c8c8c8c8c8c88888c8d4c14c01488d4c07c0188d4c0880048894cd4c09c02454cd4c1854cd4c184cc06d401c004418c4ccd5cd19b8f001003063062153353061332233355301e1200135020501f23535505e001223335530211200135023502223535506100122333535501d0012330694800000488cc1a80080048cc1a400520000013301200200133355301412001500f50343235302d001222222222233355301f120012235303d002222353045003223353068002253353074333573466e3c0580041d81d44cd411801401c401c801d40fc025401c00854cd4c184ccd5cd19b8833300c3300d500735355505d006222003489004881004820293a00c18818c4ccd5cd19b8833300c3300d50073535505b005220024881004881004820225e818818c4188418841884cc06d401c00c4d4c08c00488008888c8c8c004014c8004d5417088cd4d40b000520002235355057002225335305f333573466e3c0080241841804c01c0044c01800cc8004d5416c88cd4d40ac00520002235355056002225335305e333573466e3c00801c18017c40044c01800c88d4c0840088888888888ccd54c04c48005403940cccd54c034480048d4d5416c00488004ccd54c04c4800488d4c0c40088894cd4d40ec00484d4c0e801088cd4c174008802094cd4c1a4ccd5cd19b8f00101406b06a133503b3355064004006008100810045033009320013550562211225335350280011502a22133502b300400233553006120010040011223355300c1200123535504f0012233550520023355300f12001235355052001223355055002333535500e0012330594800000488cc1680080048cc164005200000133003002001223355300b1200123535504e001223355051002333535500a00123355300f120012353550520012233550550023550110010012233355500801100200123355300f1200123535505200122335505500235500f00100133355500300c0020011112223335530061200150253355300b1200123535504e00122335505100235500d00133355300612001223535504f002225335305733355301212001323350172233353500b003220020020013535009001220013350092253353059002105b1001058235355052001223300a0020050061003133502900400350260013355300b1200123535504e0012232335505200330010053200135505922533535029001135500d00322135355054002225335305c3300c002008133550120070011300600300212212330010030021200132001355050221122253353502300110022213300500233355300712001005004001112122230030041122122233002005004112122230010041120013200135504b22112253353501d0011501f2213350203004002335530061200100400122333573466e3c00800412c12888d4c04c00888888888894cd4d40a0ccd54c03448004cd4044894cd4d40a80088400c400540a494cd4c14cccd5cd19b8f00c00105505413502b0011502a00321055105332001355048221122253353501b001135350080032200122133353500a0052200230040023335530071200100500400113350052253353046002100110470461233500322333535006003220020020013535004001220011221233001003002120011221233001003002120012123001002200122212333001004003002200112200212200120012212330010030022001222222222212333333333300100b00a009008007006005004003002200122123300100300220012221233300100400300220011122002122122330010040031200122123300100300220011212230020031122001120011221233001003002120011221233001003002120011221233001003002120011212223003004112220021122200112001212222300400521222230030052122223002005212222300100520012212330010030022001212222222300700822122222223300600900821222222230050081222222200412222222003221222222233002009008221222222233001009008200121223002003222122333001005004003200121223002003212230010032001221233001003002200111221233001003002112001111222123330010040030021112001223370000400244666ae68cdc380100080280209100109100090008891918008009119801980100100099911991199119801199aaa80224411d7175e003e0749ce453fc419933297de37f4e859324dc79d1156b3699f900483403d20ae11335500648811d711eae0514665de6ac91a0ba5387e76474ebda9cc70c7301cb7a125261004828270048848cc00400c008800444488848ccc00401000c0084448004448848cc00400c0084480041"))),a},N=function(){return s.Z.Cardano.Address.from_bech32("addr_test1wqwkldau5tz2w4ju4r7ulz5hlfm60dlq89mc30ype4hxx9cqkcj6h")},P=function(a){var e=a.tradeOwner,t=a.requestedAmount,r=a.privateRecip,n=s.Z.Cardano.PlutusList.new();n.add(s.Z.Cardano.PlutusData.new_bytes((0,o.H_)(e))),n.add(s.Z.Cardano.PlutusData.new_bytes(t)),n.add(s.Z.Cardano.PlutusData.new_bytes((0,o.H_)(r)));var c=s.Z.Cardano.PlutusList.new();return c.add(s.Z.Cardano.PlutusData.new_constr_plutus_data(s.Z.Cardano.ConstrPlutusData.new(s.Z.Cardano.Int.new_i32(0),n))),s.Z.Cardano.PlutusData.new_constr_plutus_data(s.Z.Cardano.ConstrPlutusData.new(s.Z.Cardano.Int.new_i32(B.Offer),c))},B={Offer:0},A=function(a){var e=s.Z.Cardano.PlutusData.new_constr_plutus_data(s.Z.Cardano.ConstrPlutusData.new(s.Z.Cardano.Int.new_i32(0),s.Z.Cardano.PlutusList.new()));return s.Z.Cardano.Redeemer.new(s.Z.Cardano.RedeemerTag.new_spend(),s.Z.Cardano.BigNum.from_str(a),e,s.Z.Cardano.ExUnits.new(s.Z.Cardano.BigNum.from_str("694200"),s.Z.Cardano.BigNum.from_str("300000000")))},O=function(a){var e=s.Z.Cardano.PlutusData.new_constr_plutus_data(s.Z.Cardano.ConstrPlutusData.new(s.Z.Cardano.Int.new_i32(1),s.Z.Cardano.PlutusList.new()));return s.Z.Cardano.Redeemer.new(s.Z.Cardano.RedeemerTag.new_spend(),s.Z.Cardano.BigNum.from_str(a),e,s.Z.Cardano.ExUnits.new(s.Z.Cardano.BigNum.from_str("694200"),s.Z.Cardano.BigNum.from_str("300000000")))},E=function(){function a(a){var e=a.base,t=a.projectId;this.provider={base:e,projectId:t}}var e=a.prototype;return e.blockfrostRequest=function(){var a=(0,r.Z)(c().mark((function a(e,t,r){return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch(this.provider.base+e,{headers:Object.assign({project_id:this.provider.projectId},t,{"User-Agent":"cardano-escrow"}),method:r?"POST":"GET",body:r}).then((function(a){return a.json()}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a,this)})));return function(e,t,r){return a.apply(this,arguments)}}(),e.getUtxo=function(){var a=(0,r.Z)(c().mark((function a(e){var t;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.blockfrostRequest("/addresses/"+N().to_bech32()+"/utxos");case 2:return(t=a.sent).filter(function(){var a=(0,r.Z)(c().mark((function a(t){return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(1!=(0,o.D)(t.amount).compare(e)){a.next=5;break}return a.abrupt("return",!0);case 5:return a.abrupt("return",!1);case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()),console.log(JSON.stringify(t)),a.next=7,Promise.all(t.map(function(){var a=(0,r.Z)(c().mark((function a(t){return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",{offer:e,utxo:s.Z.Cardano.TransactionUnspentOutput.new(s.Z.Cardano.TransactionInput.new(s.Z.Cardano.TransactionHash.from_bytes((0,o.H_)(t.tx_hash)),t.output_index),s.Z.Cardano.TransactionOutput.new(N(),(0,o.D)(t.amount)))});case 1:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()));case 7:return a.abrupt("return",a.sent);case 8:case"end":return a.stop()}}),a,this)})));return function(e){return a.apply(this,arguments)}}(),e.initTx=function(){var a=(0,r.Z)(c().mark((function a(){var e,t,r,n,o;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=s.Z.Cardano.TransactionBuilder.new(s.Z.Cardano.LinearFee.new(s.Z.Cardano.BigNum.from_str(this.protocolParameters.linearFee.minFeeA),s.Z.Cardano.BigNum.from_str(this.protocolParameters.linearFee.minFeeB)),s.Z.Cardano.BigNum.from_str(this.protocolParameters.minUtxo),s.Z.Cardano.BigNum.from_str(this.protocolParameters.poolDeposit),s.Z.Cardano.BigNum.from_str(this.protocolParameters.keyDeposit),this.protocolParameters.maxValSize,this.protocolParameters.maxTxSize,this.protocolParameters.priceMem,this.protocolParameters.priceStep,s.Z.Cardano.LanguageViews.new(Buffer.from("a141005901d59f1a000302590001011a00060bc719026d00011a000249f01903e800011a000249f018201a0025cea81971f70419744d186419744d186419744d186419744d186419744d186419744d18641864186419744d18641a000249f018201a000249f018201a000249f018201a000249f01903e800011a000249f018201a000249f01903e800081a000242201a00067e2318760001011a000249f01903e800081a000249f01a0001b79818f7011a000249f0192710011a0002155e19052e011903e81a000249f01903e8011a000249f018201a000249f018201a000249f0182001011a000249f0011a000249f0041a000194af18f8011a000194af18f8011a0002377c190556011a0002bdea1901f1011a000249f018201a000249f018201a000249f018201a000249f018201a000249f018201a000249f018201a000242201a00067e23187600010119f04c192bd200011a000249f018201a000242201a00067e2318760001011a000242201a00067e2318760001011a0025cea81971f704001a000141bb041a000249f019138800011a000249f018201a000302590001011a000249f018201a000249f018201a000249f018201a000249f018201a000249f018201a000249f018201a000249f018201a00330da70101ff","hex"))),r=s.Z.Cardano.PlutusList.new(),(e={})[406]={},n=e,o=s.Z.Cardano.TransactionOutputs.new(),a.abrupt("return",{txBuilder:t,datums:r,metadata:n,outputs:o});case 5:case"end":return a.stop()}}),a,this)})));return function(){return a.apply(this,arguments)}}(),e.createOutput=function(a,e,t){var r=void 0===t?{}:t,n=r.datum,c=r.tradeOwnerAddress,d=r.metadata,u=s.Z.Cardano.min_ada_required(e,s.Z.Cardano.BigNum.from_str(this.protocolParameters.minUtxo),n&&s.Z.Cardano.hash_plutus_data(n));1==u.compare(e.coin())&&e.set_coin(u);var i=s.Z.Cardano.TransactionOutput.new(a,e);return n&&i.set_data_hash(s.Z.Cardano.hash_plutus_data(n)),c&&(d[406].address="0x"+(0,o.NC)(c.to_address().to_bytes())),i},e.setCollateral=function(a,e){var t=s.Z.Cardano.TransactionInputs.new();e.forEach((function(a){t.add(a.input())})),a.set_collateral(t)},e.finalizeTx=function(){var a=(0,r.Z)(c().mark((function a(e){var t,r,n,d,u,i,f,m,l,p,_,b,h,g,w,C,Z,x,y,v,N,P,B,A,O,E,S,U,D,I=this;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:for(t=e.txBuilder,r=e.changeAddress,n=e.utxos,d=e.outputs,u=e.datums,i=e.metadata,f=e.scriptUtxo,m=e.action,console.log(d),l=s.Z.Cardano.TransactionWitnessSet.new(),p=k.randomImprove(n,d,8,f?[f]:[]),_=p.input,b=p.change,_.forEach((function(a){t.add_input(a.output().address(),a.input(),a.output().amount())})),h=0;h<d.len();h++)t.add_output(d.get(h));if(!f){a.next=22;break}return g=s.Z.Cardano.Redeemers.new(),w=t.index_of_input(f.input()).toString(),g.add(m(w)),t.set_redeemers(s.Z.Cardano.Redeemers.from_bytes(g.to_bytes())),t.set_plutus_data(s.Z.Cardano.PlutusList.from_bytes(u.to_bytes())),t.set_plutus_scripts(T()),a.next=15,window.cardano.getCollateral();case 15:if(!((C=a.sent.map((function(a){return s.Z.Cardano.TransactionUnspentOutput.from_bytes((0,o.H_)(a))}))).length<=0)){a.next=18;break}throw new Error("NO_COLLATERAL");case 18:this.setCollateral(t,C),l.set_plutus_scripts(T()),l.set_plutus_data(u),l.set_redeemers(g);case 22:if(i&&(Z=s.Z.Cardano.AuxiliaryData.new(),x=s.Z.Cardano.GeneralTransactionMetadata.new(),Object.keys(i).forEach((function(a){Object.keys(i[a]).length>0&&x.insert(s.Z.Cardano.BigNum.from_str(a),s.Z.Cardano.encode_json_str_to_metadatum(JSON.stringify(i[a]),1))})),Z.set_metadata(x),t.set_auxiliary_data(Z)),(y=b.multiasset())&&2*b.to_bytes().length>this.protocolParameters.maxValSize&&(v=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0")),N=s.Z.Cardano.MultiAsset.new(),P=y.keys(),function(){for(var a=0;a<y.len();a++){for(var e=P.get(a),t=y.get(e),r=t.keys(),n=s.Z.Cardano.Assets.new(),c=0;c<r.len();c++){var o=r.get(c),d=t.get(o);n.insert(o,d);var u=s.Z.Cardano.MultiAsset.from_bytes(N.to_bytes());u.insert(e,n);var i=s.Z.Cardano.Value.new(s.Z.Cardano.BigNum.from_str("0"));if(i.set_multiasset(u),2*i.to_bytes().length>=I.protocolParameters.maxValSize)return void N.insert(e,n)}N.insert(e,n)}}(),v.set_multiasset(N),B=s.Z.Cardano.min_ada_required(v,s.Z.Cardano.BigNum.from_str(this.protocolParameters.minUtxo)),v.set_coin(B),t.add_output(s.Z.Cardano.TransactionOutput.new(r.to_address(),v))),t.add_change_if_needed(r.to_address()),A=t.build(),O=s.Z.Cardano.Transaction.new(A,s.Z.Cardano.TransactionWitnessSet.from_bytes(l.to_bytes()),Z),E=2*O.to_bytes().length,console.log(E),!(E>this.protocolParameters.maxTxSize)){a.next=32;break}throw new Error("MAX_SIZE_REACHED");case 32:return a.next=34,window.cardano.signTx((0,o.NC)(O.to_bytes()),!0);case 34:return S=a.sent,S=s.Z.Cardano.TransactionWitnessSet.from_bytes((0,o.H_)(S)),l.set_vkeys(S.vkeys()),U=s.Z.Cardano.Transaction.new(O.body(),l,O.auxiliary_data()),console.log("Full Tx Size",U.to_bytes().length),a.next=41,window.cardano.submitTx((0,o.NC)(U.to_bytes()));case 41:return D=a.sent,a.abrupt("return",D);case 43:case"end":return a.stop()}}),a,this)})));return function(e){return a.apply(this,arguments)}}(),e.load=function(){var a=(0,r.Z)(c().mark((function a(){var e;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.Z.load();case 2:return a.next=4,this.blockfrostRequest("/epochs/latest/parameters");case 4:e=a.sent,this.protocolParameters={linearFee:{minFeeA:e.min_fee_a.toString(),minFeeB:e.min_fee_b.toString()},minUtxo:"1000000",poolDeposit:"500000000",keyDeposit:"2000000",maxValSize:"5000",maxTxSize:16384,priceMem:.0577,priceStep:721e-7},this.contractInfo={owner1:{address:s.Z.Cardano.Address.from_bech32("addr_test1wp67qqlqwjwwg5lugxvnx2taudl5apvnynw8n5g4dvmfn7g56n5y8"),fee1:s.Z.Cardano.BigNum.from_str("1000"),fee2:s.Z.Cardano.BigNum.from_str("1111")},owner2:{address:s.Z.Cardano.Address.from_bech32("addr_test1wq02upg5vew7dty35za98pl8v36whk5ucux8xqwt0gf9ycgyf7eee"),fee:s.Z.Cardano.BigNum.from_str("10000")}},k.setProtocolParameters(this.protocolParameters.minUtxo,this.protocolParameters.linearFee.minFeeA,this.protocolParameters.linearFee.minFeeB,this.protocolParameters.maxTxSize.toString());case 8:case"end":return a.stop()}}),a,this)})));return function(){return a.apply(this,arguments)}}(),e.offer=function(){var a=(0,r.Z)(c().mark((function a(e,t,r){var n,d,u,i,f,m,l,p,_;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.initTx();case 2:return n=a.sent,d=n.txBuilder,u=n.datums,i=n.metadata,f=n.outputs,a.t0=s.Z.Cardano.BaseAddress,a.t1=s.Z.Cardano.Address,a.t2=o.H_,a.next=12,window.cardano.getUsedAddresses();case 12:return a.t3=a.sent[0],a.t4=(0,a.t2)(a.t3),a.t5=a.t1.from_bytes.call(a.t1,a.t4),m=a.t0.from_address.call(a.t0,a.t5),a.next=18,window.cardano.getUtxos();case 18:return l=a.sent.map((function(a){return s.Z.Cardano.TransactionUnspentOutput.from_bytes((0,o.H_)(a))})),p=P({tradeOwner:(0,o.NC)(m.payment_cred().to_keyhash().to_bytes()),requestedAmount:t,privateRecip:""==r?(0,o.NC)(m.payment_cred().to_keyhash().to_bytes()):r}),f.add(this.createOutput(N(),e,{datum:p,index:0,tradeOwnerAddress:m,metadata:i})),u.add(p),a.next=24,this.finalizeTx({txBuilder:d,changeAddress:m,utxos:l,outputs:f,datums:u,metadata:i});case 24:return _=a.sent,a.abrupt("return",_);case 26:case"end":return a.stop()}}),a,this)})));return function(e,t,r){return a.apply(this,arguments)}}(),e.getOffer=function(){var a=(0,r.Z)(c().mark((function a(e){var t;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getUtxo(e);case 2:if(1!==(t=a.sent).length){a.next=5;break}return a.abrupt("return",t[0]);case 5:if(0!==t.length){a.next=7;break}return a.abrupt("return",null);case 7:return console.log("DANGER: Multiple potentially valid offers in the script."),a.abrupt("return",t[0]);case 9:case"end":return a.stop()}}),a,this)})));return function(e){return a.apply(this,arguments)}}(),e.purchase=function(){var a=(0,r.Z)(c().mark((function a(e,t,r){var n,d,u,i,f,m,l,p,_,b,h,g,w;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.initTx();case 2:return n=a.sent,d=n.txBuilder,u=n.datums,n.metadata,i=n.outputs,f=s.Z.Cardano.BaseAddress.from_address(s.Z.Cardano.Address.from_bech32(e)),a.t0=s.Z.Cardano.BaseAddress,a.t1=s.Z.Cardano.Address,a.t2=o.H_,a.next=13,window.cardano.getUsedAddresses();case 13:return a.t3=a.sent[0],a.t4=(0,a.t2)(a.t3),a.t5=a.t1.from_bytes.call(a.t1,a.t4),m=a.t0.from_address.call(a.t0,a.t5),a.next=19,window.cardano.getUtxos();case 19:return l=a.sent.map((function(a){return s.Z.Cardano.TransactionUnspentOutput.from_bytes((0,o.H_)(a))})),console.log(JSON.stringify(l)),a.next=23,this.getOffer(t);case 23:if(null!=(p=a.sent)){a.next=26;break}throw"Offer is null.";case 26:return _=P({tradeOwner:(0,o.NC)(f.payment_cred().to_keyhash().to_bytes()),requestedAmount:r,privateRecip:(0,o.NC)(f.payment_cred().to_keyhash().to_bytes())}),u.add(_),b=s.Z.Cardano.PlutusData.new_bytes(42),h=p.utxo.output().amount(),i.add(this.createOutput(m.to_address(),h,{index:0})),console.log("requestedAmount: "+(0,o.I6)(r)),i.add(this.createOutput(f.to_address(),r,{index:1})),i.add(this.createOutput(this.contractInfo.owner1.address,(0,o.D)([{unit:"lovelace",quantity:"4000000"}]),{datum:b,index:2})),u.add(b),i.add(this.createOutput(this.contractInfo.owner2.address,(0,o.D)([{unit:"lovelace",quantity:"1000000"}]),{datum:b,index:3})),u.add(b),(g=s.Z.Cardano.Ed25519KeyHashes.new()).add(m.payment_cred().to_keyhash()),d.set_required_signers(g),a.next=42,this.finalizeTx({txBuilder:d,changeAddress:m,utxos:l,outputs:i,datums:u,scriptUtxo:p.utxo,action:A});case 42:return w=a.sent,a.abrupt("return",w);case 44:case"end":return a.stop()}}),a,this)})));return function(e,t,r){return a.apply(this,arguments)}}(),e.cancelOffer=function(){var a=(0,r.Z)(c().mark((function a(e,t,r){var n,d,u,i,f,m,l,p,_,b,h;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.initTx();case 2:return n=a.sent,d=n.txBuilder,u=n.datums,i=n.outputs,a.t0=s.Z.Cardano.BaseAddress,a.t1=s.Z.Cardano.Address,a.t2=o.H_,a.next=11,window.cardano.getUsedAddresses();case 11:return a.t3=a.sent[0],a.t4=(0,a.t2)(a.t3),a.t5=a.t1.from_bytes.call(a.t1,a.t4),f=a.t0.from_address.call(a.t0,a.t5),a.next=17,window.cardano.getUtxos();case 17:return m=a.sent.map((function(a){return s.Z.Cardano.TransactionUnspentOutput.from_bytes((0,o.H_)(a))})),l=this.getOffer(t),p=P({tradeOwner:(0,o.NC)(e.payment_cred().to_keyhash().to_bytes()),requestedAmount:r,privateRecip:(0,o.NC)(e.payment_cred().to_keyhash().to_bytes())}),u.add(p),_=l.utxo.output().amount(),i.add(this.createOutput(f.to_address(),_)),(b=s.Z.Cardano.Ed25519KeyHashes.new()).add(f.payment_cred().to_keyhash()),d.set_required_signers(b),a.next=28,this.finalizeTx({txBuilder:d,changeAddress:f,utxos:m,outputs:i,datums:u,scriptUtxo:l.utxo,action:O});case 28:return h=a.sent,a.abrupt("return",h);case 30:case"end":return a.stop()}}),a,this)})));return function(e,t,r){return a.apply(this,arguments)}}(),a}(),S=E},2081:function(a,e,t){var r=t(5861),n=t(3144),c=t(7757),s=t.n(c),o=function(){function a(){}return a.prototype.load=function(){var a=(0,r.Z)(s().mark((function a(){return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!this._wasm){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,Promise.all([t.e(973),t.e(939)]).then(t.bind(t,1225));case 4:this._wasm=a.sent;case 5:case"end":return a.stop()}}),a,this)})));return function(){return a.apply(this,arguments)}}(),(0,n.Z)(a,[{key:"Cardano",get:function(){return this._wasm}}]),a}();e.Z=new o},3427:function(a,e,t){t.d(e,{H_:function(){return s},NC:function(){return o},PX:function(){return d},D:function(){return u},I6:function(){return i}});var r=t(2982),n=t(2426),c=t(2081),s=function(a){return n.lW.from(a,"hex")},o=function(a){return n.lW.from(a).toString("hex")},d=function(a){return n.lW.from(a).toString("hex")},u=function(a){var e=c.Z.Cardano.MultiAsset.new(),t=a.find((function(a){return"lovelace"===a.unit}));(0,r.Z)(new Set(a.filter((function(a){return"lovelace"!==a.unit})).map((function(a){return a.unit.slice(0,56)})))).forEach((function(t){var r=a.filter((function(a){return a.unit.slice(0,56)===t})),s=c.Z.Cardano.Assets.new();r.forEach((function(a){s.insert(c.Z.Cardano.AssetName.new(n.lW.from(a.unit.slice(56),"hex")),c.Z.Cardano.BigNum.from_str(a.quantity))})),e.insert(c.Z.Cardano.ScriptHash.from_bytes(n.lW.from(t,"hex")),s)}));var s=c.Z.Cardano.Value.new(c.Z.Cardano.BigNum.from_str(t?t.quantity:"0"));return(a.length>1||!t)&&s.set_multiasset(e),s},i=function(a){var e=[];if(e.push({unit:"lovelace",quantity:a.coin().to_str()}),a.multiasset())for(var t=a.multiasset().keys(),r=0;r<t.len();r++)for(var c=t.get(r),s=a.multiasset().get(c),o=s.keys(),d=0;d<o.len();d++){var u=o.get(d),i=s.get(u),f=n.lW.from(c.to_bytes(),"hex").toString("hex")+n.lW.from(u.name(),"hex").toString("hex");e.push({unit:f,quantity:i.to_str()})}return e}}}]);
//# sourceMappingURL=ee57c9ba743e71c4bbae5383b7d5422910dfe089-7bea4d938f9a967d14f9.js.map